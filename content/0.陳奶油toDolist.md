#firstTarget #theme #Target #code

[[參考資料]]
[[line bot]]
[[名詞]]

aiot學習目標
- [x] python
- [x] golang
	- [x] 並且使用golang回應?
	- [ ] 盡量使用 python建置互聯網零件
	- [x] 所以會選擇esp32 有三片
	- [ ] 可以考慮使用有攝影機的部分


#code

----------------------
- [ ] 數位貨幣
****

- [ ] esp32相關研究
https://randomnerdtutorials.com/

-------------------


- [x] 繼續處理aws to golang
	 go env -w GO111MODULE=on      
	 go mod init Gone
	 go get github.com/go-sql-driver/mysql
	 在linux沒問題

	接下來要怎麼做
	- [x] 需要研究quatrz 4.0
	- [x] 安裝以後初始化設定看不太懂
	- [ ] 設計鹹魚王教學
	- [ ] 活動規劃
	- [ ] 先解箱子直到第四輪
	- [ ] 每天買箱子
	- [ ] 買普通釣魚竿
	- [ ] 買黃金釣魚竿
	- [ ] 競技場240場
	- [ ] 參加工會活動3456
	- [ ] 小技巧
	- [ ] 每天解鹹魚鍋
- [ ] 益民查到的課程
	- [ ] https://edu.tcfst.org.tw/web/tw/class/show.asp?courseidori=12Q329
	
	- [x] https://edu.tcfst.org.tw/web/tw/class/show.asp?courseidori=12C026
		太貴
	
	

- [x] 幫弟弟處理出國的喘息服務
	- [x] 等待消息
	- [ ] 11/3會過來

- [ ] 國泰打電話過去找apple
	+886 (2) 7752 4883
- [ ] 測試內文超連結 不過這個功能是外部連結
[test](#Target )

![[Pasted image 20231006134443.png]]

- [ ] 參數命名方式
	再看一下
	[[Golang 變數宣告（variables）]]
	https://pjchender.dev/golang/variables/
- [ ] 想要學會跳區段的指令markdown
- [ ] [[課程]] 確認是否要報名
	- [x] 10/29放棄
	- [ ] 113/02/21 想辦法
- [ ] 繼續寫go
	- [x] 將程式碼整理上去
	- [x] 使用esp32
	- [x] 測試wifi
	- [x] 測試localhost
		ip 需要設定成這個 192.168.42.125 
		![[Pasted image 20231017104924.png]]
	- [x] dht11 接線
	- [x] dht資料呈現
		- [x] http://localhost:9090/httpchart
	- [x] 備份資料
	- [x] 轉移資料到aws上
		- [x] 如何保持穩定連線 當太久沒有連線那個程式碼會失去效果
		```c
		if (WiFi.status() != WL_CONNECTED) { WifiConnect_loop(); }//20230928 error here
		```
			[[aiot蔡佳喻]]
			 ```c
			WiFi.status() == WL_CONNECTED
			```
		- [x] root 登入scp有問題
		- [x] ubuntu 登入
		- [x] go 安裝
			- [x] 使用sudo指令可以克服權限不足問題，但是需要住注意安裝位的安全性
		- [x] go run http.go 會自動去尋找需要的檔案 所以環境部用特別處理
		- [x] 查詢sql
			- [x] http://3.82.216.100/phpmyadmin/index.php?route=/sql&db=nodemcu&table=temp_humi&pos=0
			- [x] 密碼在手冊note上
			- [x] sql安裝檔案
			- [ ] insertnull檔案異常，最造成當機
			![[Pasted image 20231019150459.png]]
			- [ ] 放置太久會斷線則 http.go會有異常 要改寫到bath檔案上
				
		- [x] 要編譯檔案
			- [x] 直接使用go run http.go
				- [ ] 但是要改用其他方式執行
					讓他能夠持續運行
					不然關掉視窗程式就關閉了
		- [ ] 發現連線要開啟xampp有點白痴 所以需要重新研究安裝mysql server
		- [x] sql密碼調整
			- [x] 設定連線localhost 
			- [x] 連線到aws sql
			- [ ] esp32 連線字串整理
	- [x] 測試環境
	- [x] 測試連線
	- [x] 安裝在docker裡面
		- [x] 直接使用謝老師的版本
		- [x] 安裝mongle
		- [ ] 資料格式
		- [ ] 存入資料
		- [ ] 讀出資料
		- [ ] 顯示圖表
- [x] 繼續寫內在原力筆記
- [ ] [[演算法-你好]]
	- [ ] https://www.technice.com.tw/category/classnotes/ 科技島
- [ ] coursera 課程研究 
	為來的學習方向
	https://www.coursera.org/ 
- [x] 專題結構
	- [ ] 主題
	- [x] 市場需求分析
	- [x] 市場分析
	- [x] 產品功能與規格
	- [x] 競爭產品比較
	- [x] 優勢
	- [x] 時程
	- [ ] 對就業幫助
	- [x] 智慧農場溫控
	- [ ] 成果分享
- [x] 專題老師結構 放棄這個做法
	與thingspeak比較
	我哪裡比較好
	我哪裡比較差
	有點單薄
	優點
	有限次數vs上傳次數不限
	缺點
	免費vs每月要花3$美金

	對就業幫助

- [ ] 專題我的結構
	[[5.2專題研究]]
	起 
		為什麼我要使用golang
		因為我看到 一些有趣的工作是使用這個語言
		目前對於程式語言的工作感受是，如果有需要就要去學習這個語言
	承 
		我改寫 蕭老師的aws專題
	轉 
		引用謝老師的 docker mogodb
	合
		專題報告
		對就業幫助
修改IP後透過arduino上傳到 ESP32

- [ ] tracert www.google.com
	博聞提供 這個指令去檢查出去的訊息是否走正確的路

- [ ] 開機執行
	關鍵字 查詢22.04 rc.local cli
	有點困難
- [ ] 當機處理
	processid 先不用
		用watch dog方式處理
	```command
	ps auxi|grep goht[t]p.go
	ps aux | grep bas[h]  && echo t || echo f
	ps aux | grep goh[t]tp  && echo t || echo f
	```

- [ ] 謝老師提供程式
![[Pasted image 20231020172227.png]]
home.py
```python
#! /usr/local/bin/python
from flask import Flask, request, render_template
from flask_socketio import SocketIO, emit
import pymongo, json, threading

portNo = 8000
dbs_name = 'iot'
docs_name = 'temp'

db_client = pymongo.mongo_client.MongoClient( 'iot_mongo', 27017)
#db_client = pymongo.mongo_client.MongoClient( 'localhost', 27017)
db   = db_client.get_database( dbs_name )  # db = db_client[ dbs_name ]
docs = db.get_collection( docs_name )      # docs = db[ docs_name ]

app = Flask(__name__)
socketio = SocketIO(app)
#socketio = SocketIO(app, logger=True, engineio_logger=True)

@app.route('/')
def index():
    return render_template('index.html', async_mode= socketio.async_mode )

@app.route('/ctrl.js')
def ctrl_js():
    return render_template('ctrl.js')

@app.route('/jquery.canvasjs.min.js')
def canvasjs():
    return render_template('jquery.canvasjs.min.js')

@app.route('/get_data.jsp', methods=['POST'] )
def get_data():
    data = list( docs.find({'tmp':{'$exists':True},"dt":{'$exists':True}} , { '_id':0 , 'tmp':1, 'dt':1 }).sort('dt', pymongo.DESCENDING) )
#    print( data )
    print( len(data) )
    return json.dumps(data)

@app.route('/datacominginws', methods=['POST'] )
def data_coming():
    data = request.json.get("D")
    print("receive data:{}".format(data))
    aa=socketio.emit('datacoming', {'data': data} , broadcast=True )
    print(aa)
    print('=========================================')
    return ''

@app.route('/wstest' )
def wstest():
#    data = request.json.get("D")
    print("*** ws-test ***")
    socketio.emit('wstest', {'d': 'from-server'} , broadcast=True )
    socketio.send('ws send message' , broadcast=True )
    print('=========================================')
    return 'for wstest'

@socketio.on('hello' ) # 很重要 至少要有一個 socketio.on ，否則連線會被切掉
def ev_hello():
#    data = request.json.get("D")
    print("*** event hello ***")
    print('=========================================')


if __name__ == '__main__':
  print( "app.run()" )
  socketio.run(app, debug=True, host='0.0.0.0', port=portNo )



```
![[Pasted image 20231020172233.png]]
iot_data.py
```python
#! /usr/local/bin/python
from flask import Flask, request
from time import localtime, strftime
import pymongo, json 
import requests as req
from waitress import serve

dataPortNo = 12321
dbs_name = 'iot'
docs_name = 'temp'
wwwurl = 'http://iot_www:8000/datacominginws'
#wwwurl = 'http://localhost:8307/datacominginws'
db_client = pymongo.mongo_client.MongoClient( 'iot_mongo', 27017)
#db_client = pymongo.mongo_client.MongoClient( 'localhost', 27017)
db   = db_client.get_database( dbs_name )  # db = db_client[ dbs_name ]
docs = db.get_collection( docs_name )      # docs = db[ docs_name ]

app = Flask(__name__)

@app.route('/')
def index():
  try:
      tmp = int( request.args.get('tmp') )
      data = { 'dt' : strftime("%Y-%m-%d %H:%M:%S", localtime()) , 'tmp': tmp }
      docs.insert_one( data )
      del data[ '_id' ]
      req.post(wwwurl, json = {'D': json.dumps( data ) })
  except Exception as err:
      print( 'Got Exception:' + err.args[0] )
  finally:
      return '.'

if __name__ == '__main__':
  print( "app.run()" )
  app.run(debug=True,host='0.0.0.0', port=dataPortNo )
#  serve( app, host='0.0.0.0', port=dataPortNo )


```

連線到mongo db
```
sudo docker ps
```
![[Pasted image 20231025184601.png]]
修改程式連線字串
![[Pasted image 20231025184612.png]]

- [ ] 請俊宏幫忙焊接
- [ ] 規劃 aws 吐Ip到 goole上
- [ ] esp 到google上要ip
- [ ] 博聞提供 load balance
- [ ] cluster 這兩個功能可以達成大量連線時 不斷線
- [ ] 參考
- [ ] https://docs.oracle.com/cd/E19787-01/820-3937/x-4n682/index.html
- [ ] https://docs.oracle.com/cd/E19050-01/sun.cluster30/806-6722/6jfl64b4c/index.html
- [ ] 使用謝老師的mongodb 讀取資料庫 寫入資料 
	
- [ ] 讀取資料

- [ ] 開機程式 systemd  

- [ ] aws連線工具
- [ ] mobaxterm
https://mobaxterm.mobatek.net/download.html
- [ ] winscp
- [ ] mongodb可以與瑞環討論
- [ ] 目前可以看資料結構
- [ ] 想要重看謝老師的影片
